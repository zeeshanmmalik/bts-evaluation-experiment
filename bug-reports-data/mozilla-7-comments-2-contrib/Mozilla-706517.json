{
    "contributors": [
        [
            "Steve Workman [:sworkman]", 
            "lexrank"
        ], 
        [
            "Jason Duell (:jduell)", 
            "email"
        ]
    ], 
    "title": "Intermittent test leak of about 1-3KB (1 CondVar, 2 Mutex, some nsDNSAsyncRequest, 1 nsHTMLDNSPrefetch::nsListener, 1 nsHostRecord, ...)", 
    "comments": [
        {
            "date": "2011-11-30 09:19:14", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7644429&tree=Mozilla-Inbound\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test mochitests-1/5 on 2011-11-29 15:50:45 PST for push 39346d506e54\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 3240 bytes during test execution\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of CondVar with size 32 bytes\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 2 instances of Mutex with size 24 bytes each (48 bytes total)\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 29 instances of nsDNSAsyncRequest with size 88 bytes each (2552 bytes total)\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of nsHTMLDNSPrefetch::nsListener with size 24 bytes\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of nsHostRecord with size 128 bytes\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-INFO | automationutils.processLeakLog() | leaked 1 instance of nsHostResolver with size 232 bytes\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-INFO | automationutils.processLeakLog() | leaked 27 instances of nsStringBuffer with size 8 bytes each (216 bytes total)\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-INFO | automationutils.processLeakLog() | leaked 1 instance of nsTArray_base with size 8 bytes\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "and\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7644414&tree=Mozilla-Inbound\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test mochitests-5/5 on 2011-11-29 15:59:43 PST for push 4b085d906272\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 760 bytes during test execution\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of CondVar with size 32 bytes\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 2 instances of Mutex with size 24 bytes each (48 bytes total)\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 3 instances of nsDNSAsyncRequest with size 88 bytes each (264 bytes total)\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of nsHTMLDNSPrefetch::nsListener with size 24 bytes\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of nsHostRecord with size 128 bytes\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-INFO | automationutils.processLeakLog() | leaked 1 instance of nsHostResolver with size 232 bytes\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-INFO | automationutils.processLeakLog() | leaked 3 instances of nsStringBuffer with size 8 bytes each (24 bytes total)\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": true, 
                    "text": "TEST-INFO | automationutils.processLeakLog() | leaked 1 instance of nsTArray_base with size 8 bytes\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Matt Brubeck (:mbrubeck)", 
            "email": "Matt Brubeck (:mbrubeck)"
        }, 
        {
            "date": "2011-12-12 19:42:35", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "Moving this to necko as it seems the most likely culprit. ", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "We're detecting this leak on buildfarms--not sure how best to repro.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "Heard on IRC:\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "mbrubeck: I think those leaks are your bug 706517, and I think both they and it are \"we leak when dns in the buildfarm is kinda busted\" since in the midst of them was a talos graphserver name resolution failure\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "<catlee-away> philor: why does dns in buildfarm cause leaks?\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "<philor> catlee-away: because we don't know how to give up? ", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "I'm no necko hacker, just a phenomenologist\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "<catlee-away> that smells of tests trying to access something remote\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "<catlee-away> which we all know is BAD BAD BAD\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "<philor> I don't doubt for a second that we have them again, but they could also be prefetching dns without accessing anything, I don't think we ban dns\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "<jduell> philor catlee-away: do we have a necko bug open for the dns leak?\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Jason Duell (:jduell)", 
            "email": "Jason Duell (:jduell)"
        }, 
        {
            "date": "2011-12-12 19:47:16", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "Those two being:\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7895893&tree=Firefox\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "Rev4 MacOSX Snow Leopard 10.6 mozilla-central debug test reftest on 2011-12-12 17:43:50 PST for push 3f0c8604e2c1\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7895970&tree=Firefox\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "Rev3 Fedora 12 mozilla-central debug test mochitests-3/5 on 2011-12-12 17:54:31 PST for push 351fcbc12030\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "so not specific to an OS, or a test or two, or even a broad family of tests, with that reftest stuck in there.\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Phil Ringnalda (:philor)", 
            "email": "Phil Ringnalda (:philor)"
        }, 
        {
            "date": "2011-12-13 21:54:24", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "This pair are from the midst of the downtime which is supposed to be fixing the buildfarm's dns troubles, so they could wind up being your last two.\n", 
                    "is_in_email_summary": true
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7921363&tree=Mozilla-Inbound\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7921369&tree=Mozilla-Inbound\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Phil Ringnalda (:philor)", 
            "email": "Phil Ringnalda (:philor)"
        }, 
        {
            "date": "2011-12-13 23:32:32", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "Still during the downtime, snagged these off try because I like how they both were in mochitest-a11y, yet another suite heard from.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7921510&tree=Try\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=7921405&tree=Try\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Phil Ringnalda (:philor)", 
            "email": "Phil Ringnalda (:philor)"
        }, 
        {
            "date": "2011-12-19 18:16:16", 
            "sentences": [], 
            "name": "Steve Workman [:sworkman]", 
            "email": "Steve Workman [:sworkman]"
        }, 
        {
            "date": "2011-12-19 18:30:25", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "Did some analysis and discussed with mcmanus offline. ", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": " I agree with his first thoughts on this (bug 707930 comment 2), based on looking at the code and verifying using XPCOM_MEM_LEAK_LOG.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "Looks like the following is happening, from DNS requests being made to shutdown happening:\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "1. A thread is created using nsHostResolver::ThreadFunc.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "-- It is given a strong ref to nsHostResolver.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "-- It does a lookup, resulting in an nsHostRecord being dequeued from High, Med or Low queue.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "2. nsHostResolver::Shutdown is called.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "-- All nsHostRecords on the pending queues have OnLookupComplete called on them, which ends with them and their callbacks (nsDNSAsyncRequest or nsDNSSyncRequest objects) being released.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "-- The hash table is cleared.  This should only be the nsHostDBEnt objects which have a simple ptr to the nsHostRecord.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "3. The thread is killed (this is my assumption)\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "-- Since it has an nsHostRecord that was dequeued but not released, the ptr's refcount is > 0.  Same with all the nsDNSAsync | SyncRequests attached to the record.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "-- Since is also has a strong ref to nsHostResolver, it's refcount is also > 0.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "I have also checked this with mem leak testing, and a page with a 99999 links on it, resulting in the max number of link prefetches (512).\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "1. Load up said page.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "2. Cut network access once page is loaded and prefetching has started.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "3. Wait for 10 mins or so to allow all prefetching failures to timeout.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "4. Check mem leak logs.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "I didn't see any mem leaks for these classes using this method. ", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": " So, it looks like the leak is not progressive when access to the DNS server is cut. ", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": " Instead, as Patrick said, it's a timing issue at shutdown.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "Since it's low priority and doesn't seem to be progressive, I'm going to change importance to minor.\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Steve Workman [:sworkman]", 
            "email": "Steve Workman [:sworkman]"
        }, 
        {
            "date": "2011-12-19 18:42:47", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "Just discovered bug 463724, which has a patch to avoid the leaks, except for an intentional mutex leak. ", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": " Duping this one to that since it's the same root issue.\n", 
                    "is_in_email_summary": false
                }, 
                {
                    "is_in_lex_summary": false, 
                    "text": "\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Steve Workman [:sworkman]", 
            "email": "Steve Workman [:sworkman]"
        }, 
        {
            "date": "2012-01-01 10:55:53", 
            "sentences": [
                {
                    "is_in_lex_summary": false, 
                    "text": "https://tbpl.mozilla.org/php/getParsedLog.php?id=8265598&tree=Firefox\n", 
                    "is_in_email_summary": false
                }
            ], 
            "name": "Phil Ringnalda (:philor)", 
            "email": "Phil Ringnalda (:philor)"
        }
    ], 
    "id": "706517", 
    "project": "Mozilla", 
    "original_link": "https://bugzilla.mozilla.org/show_bug.cgi?id=706517"
}